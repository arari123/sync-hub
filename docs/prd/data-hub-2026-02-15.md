# PRD: 데이터 허브(임시) - PDF 업로드 + AI 검색 (2026-02-15)

## 배경/문제
- 부품 카탈로그/데이터시트/메뉴얼(PDF)을 업로드하고, 자연어 질의로 빠르게 탐색/추천/조치방법을 얻고 싶다.
- 대상 문서는 한글/영문 버전이 혼합되며, 특정 프로젝트와 무관한 지식 허브로 운영되어야 한다.
- Gemini Flash 모델을 사용하되, **LLM 토큰 사용은 최소화**되어야 한다.
  - 모델명은 `GEMINI_MODEL`로 교체 가능하며, 기본값은 `gemini-2.5-flash`이다.

## 목표
1. 프로젝트/예산/안건 등과 상호작용 없이 동작하는 **임시 데이터 허브 페이지**를 제공한다(향후 삭제 예정).
2. 텍스트 PDF를 업로드하고(관리자만), Elasticsearch 기반 검색 결과를 제공한다.
3. 검색 결과를 근거로 Gemini Flash 모델이 **추천/리스트업/조치방법**을 생성한다.
4. LLM 비용 최소화를 위해 **버튼 트리거 + 캐시 + 컨텍스트 최소화** 전략을 적용한다.

## 사용자 시나리오(예시)
- “5M 컬러 카메라를 찾아줘” → 관련 카메라 모델 리스트 + 근거 페이지
- “700W 이상 서보 모터를 찾아줄래?” → 조건 충족 항목 리스트 + 근거
- “야스카와 서보모터… 901 알람 조치방법” → 메뉴얼 기반 조치 절차 + 근거
- “키엔스 레이저 프로파일 센서로 1미터 3D 측정 추천” → 문서 근거 기반 제약/추천 + 근거

## 범위
### In scope
- FE: `/data-hub` 페이지(ProtectedRoute), 문서 검색 결과/상세, AI 답변 패널, 관리자 업로드 패널
- BE: `/data-hub/*` API(permissions, upload, ask), Gemini 호출 모듈, 토큰 최소화/캐시
- 기존 문서 파이프라인/ES 인덱스(`documents_index`) 재사용

### Out of scope
- 프로젝트와의 연결(프로젝트 선택/ID 저장/필터링/링크 이동 등) 일체 금지
- 정형 부품 DB 구축(모델/스펙 테이블화)

## 요구사항
### FE-REQ
- FE-REQ-001: `/data-hub` 라우트를 제공하고, 홈(메인)의 빠른 메뉴에서 진입 가능해야 한다.
- FE-REQ-002: 문서 검색은 기존 `GET /documents/search` 결과를 사용해 리스트/상세를 표시한다.
- FE-REQ-003: 관리자만 PDF 업로드 UI가 노출되어야 하며, 업로드 후 처리 상태를 확인할 수 있어야 한다.
- FE-REQ-004: “AI 답변 생성” 버튼을 눌렀을 때만 LLM 호출이 발생한다.
- FE-REQ-005: AI 답변에는 근거(문서/페이지)가 함께 표시되어야 한다.

### BE-REQ
- BE-REQ-001: `GET /data-hub/permissions`로 FE가 업로드/AI 사용 가능 여부를 판단할 수 있어야 한다.
- BE-REQ-002: `POST /data-hub/documents/upload`는 **관리자만** 가능하고, PDF만 허용한다.
- BE-REQ-003: `POST /data-hub/ask`는 ES 검색 결과 상위 chunk를 근거로 Gemini Flash 모델을 호출해 답변을 생성한다.
- BE-REQ-004: 토큰 최소화를 위해 `ask`는 컨텍스트(발췌) 총량/개수를 제한해야 한다.
- BE-REQ-005: 동일 질의 + 동일 근거 조합에 대해서는 TTL 캐시로 LLM 호출을 회피해야 한다.

### OPS-REQ
- OPS-REQ-001: `npm run verify:fast`, `npm run verify`가 통과해야 한다.

## 수용 기준(AC)
1. `/data-hub`는 로그인 사용자만 접근 가능하다.
2. 업로드는 관리자만 가능하며(PDF만), 일반 사용자는 업로드 패널이 보이지 않는다.
3. 문서 검색 결과가 리스트/상세로 정상 표시된다.
4. “AI 답변 생성”은 버튼 클릭 시에만 호출되며, 답변과 근거(문서/페이지)가 함께 표시된다.
5. 반복 호출 시 캐시가 적용되어 `cache_hit=true`가 반환된다(동일 질의/근거 조합).
6. `npm run verify:fast`, `npm run verify`가 통과한다.
