# PRD: 예산 입력/대표이미지/일정 마일스톤/작업보고서·안건 상태 개선 (2026-02-20)

## 배경
- 예산 입력 모드에서 탭 전환 시 미저장 입력이 초기화되어 작업 연속성이 떨어진다.
- 프로젝트 대표 이미지가 호스팅 환경(다른 PC 접속)에서 기본 이미지로 대체되는 사례가 있다.
- 프로젝트 설정에서 대표 이미지를 경로 문자열로만 수정할 수 있어 사용성이 낮다.
- 재료비 입력 시 `파츠명`, `규격` 한글 IME 첫 글자 입력이 영문으로 들어가는 문제가 있다.
- 일정 관리 마일스톤의 이벤트 라벨 폭이 과도하고, 근접 일정에서 라벨 겹침이 발생한다.
- 작업보고서 작성/조회가 일반 안건 중심 UI여서 누락 방지 및 가독성이 부족하다.
- 안건 관리 Split View에서 작성자가 완료 상태 전환을 바로 수행하기 어렵다.

## 목표
1. 예산 입력 모드 탭 전환 시 미저장 입력 상태를 유지한다.
2. 대표 이미지 경로 호환성을 높여 호스팅/다중 PC 환경에서도 정상 표시한다.
3. 프로젝트 설정에서 대표 이미지를 파일 재업로드로 변경 가능하게 한다.
4. 재료비 입력 IME 첫 글자 오입력 문제를 제거한다.
5. 마일스톤 라벨을 텍스트 길이에 맞게 타이트하게 하고, 근접 이벤트 라벨 겹침을 줄인다.
6. 작업보고서를 단계형(스마트 위저드)으로 작성하고, 4개 섹션을 리치 텍스트로 관리한다.
7. 작업보고서 조회 시 본문 대신 섹션 내용을 가독성 좋게 표시한다.
8. 안건 관리에서 작성자 권한 기준으로 완료/진행 상태를 즉시 전환한다.

## 범위
### In Scope
- 프론트: `BudgetProjectBudget`, `BudgetProjectEditor`, `BudgetProjectInfoEdit`, `BudgetProjectScheduleManagement`, `AgendaCreate`, `AgendaDetail`, `AgendaSplitView`, `resolveApiAssetUrl` 수정
- 백엔드: 프로젝트 커버 경로 정규화 로직(`app/api/budget.py`) 및 작업보고서 섹션 HTML sanitize/검증 보완(`app/api/agenda.py`)
- 테스트/문서: 관련 단위 테스트 보강, 프로젝트 입력 스펙 업데이트

### Out of Scope
- 작업보고서 데이터 모델 전면 재설계(DB 스키마 변경)
- 마일스톤 이외 간트 차트 전체 레이아웃 재설계

## 요구사항
- REQ-001: 예산 입력 모드에서 `재료비/인건비/경비` 탭 전환 시 미저장 입력이 유지되어야 한다.
- REQ-002: `파츠명`, `규격` 컬럼 한글 IME 첫 입력이 영문으로 고정되는 현상이 없어야 한다.
- REQ-003: 대표 이미지 URL이 과거 레거시 경로(`/uploads/project-covers/*`, localhost 절대경로 포함)여도 표시 가능한 URL로 정규화되어야 한다.
- REQ-004: 프로젝트 설정 화면에서 대표 이미지 URL 텍스트 입력을 제거하고, 파일 재업로드 방식으로 수정할 수 있어야 한다.
- REQ-005: 마일스톤 이벤트 라벨 폭은 텍스트 길이에 맞춰 최소화되어야 한다.
- REQ-006: 마일스톤 근접 이벤트 라벨은 위/아래 lane 배치로 겹침을 줄여야 한다.
- REQ-007: 작업보고서 작성은 단계형 입력 UI를 제공해야 하며, 본문 입력은 제공하지 않는다.
- REQ-008: 작업보고서 `현상/원인/조치사항(중간)/조치사항(최종)`은 리치 텍스트 에디터로 입력 가능해야 한다.
- REQ-009: 작업보고서 상세/조회 시 본문 영역 대신 4개 섹션을 가시성 높은 카드 형태로 표시해야 한다.
- REQ-010: 안건 관리 Split View에서 작성자 권한(`can_change_status`)일 때 완료/진행 상태 전환 버튼을 제공해야 한다.

## 수용 기준
1. 예산 입력 모드에서 재료비 입력 후 인건비 탭 이동/복귀 시 값이 유지된다.
2. 재료비 `파츠명`, `규격`에서 한글 첫 글자 입력 시 영문 오입력이 재현되지 않는다.
3. 호스팅 환경에서 레거시 커버 경로가 저장된 프로젝트도 대표 이미지가 정상 또는 fallback 정책에 맞게 표시된다.
4. 프로젝트 설정에서 대표 이미지 업로드 후 저장 시 즉시 반영된다.
5. 마일스톤 라벨이 텍스트 길이 기준으로 기존 대비 좁아지고 근접 이벤트 겹침이 감소한다.
6. 작업보고서 작성 시 단계별 입력으로 진행 가능하며, 본문 입력 UI가 나타나지 않는다.
7. 작업보고서 상세에서 4개 섹션이 본문 위치에 표시된다.
8. 안건 관리 페이지에서 내가 작성한 안건을 선택했을 때 완료 상태 전환이 가능하다.
