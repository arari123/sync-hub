# PRD: 예산 종합 엑셀 업로드/다운로드 (2026-02-18)

## 배경
- 예산 종합 내역을 외부에서 편집/검토하기 위해 엑셀 왕복(다운로드 후 편집, 재업로드) 기능이 필요하다.
- 단순 CSV가 아니라 실무 사용성을 위해 시트별 구분, 시인성 높은 디자인, 합계 수식, 보호 정책이 필요하다.
- 사용자가 템플릿 구조를 임의 변경하면 업로드 파싱 실패/오입력이 발생할 수 있어 엄격 검증이 필요하다.

## 목표
- 예산 버전 기준으로 엑셀 템플릿 다운로드 기능 제공
- 엑셀 파일 업로드 시 집행 데이터를 반영하는 기능 제공
- 템플릿 변경/수식 훼손/보호 해제에 대한 엄격 검증과 구체 오류 메시지 제공

## 범위
- 백엔드
  - `GET /budget/versions/{version_id}/export-excel`
  - `POST /budget/versions/{version_id}/import-excel`
  - 엑셀 생성/검증/파싱 코어 모듈
- 프론트엔드
  - 예산 메인 페이지에서 엑셀 다운로드/업로드 액션 제공
  - 업로드 성공/실패 메시지 표시
- 테스트
  - 템플릿 검증 및 파싱 단위 테스트

## 비범위
- PDF 보고서 고도화
- 템플릿 다국어 지원
- 업로드를 통한 예산 항목(재료/인건/경비) 구조 변경

## 기능 요구사항
- REQ-001: 엑셀 템플릿은 `요약/재료비/인건비/경비` 시트로 분리한다.
- REQ-002: 시트는 색상/폰트 중심 디자인을 적용하고 테두리는 사용하지 않는다.
- REQ-003: 합계/소계는 수식으로 제공한다.
- REQ-004: 수식 셀은 편집 불가(잠금 + 시트 보호)로 제공한다.
- REQ-005: 업로드는 집행 데이터만 반영한다.
- REQ-006: 업로드 시 템플릿 변조를 엄격 검증한다.
- REQ-007: 오류 메시지는 `시트명!셀주소`를 포함해 반환한다.

## 정책 결정
- 업로드 범위: 집행만 반영
- 검증 모드: 엄격 검증
- 수식 보호: 잠금 + 시트 보호

## 완료 기준
- 예산 메인에서 엑셀 다운로드/업로드가 동작한다.
- 템플릿 변경(헤더/수식/보호 해제) 파일은 업로드가 차단된다.
- 정상 템플릿 업로드 시 집행 데이터가 반영된다.
- Docker 환경 `verify:fast` 통과
