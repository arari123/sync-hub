# Execution Plan: 데이터 허브(임시) - PDF 업로드 + AI 검색 (2026-02-15)

## 1. Goal
- `/data-hub` 임시 페이지를 추가하고, 텍스트 PDF 업로드(관리자만) + ES 기반 검색 + Gemini(Flash) 기반 AI 답변을 제공한다.
- 프로젝트/예산/안건과의 상호작용은 금지한다.
- LLM 토큰 사용을 최소화한다(버튼 트리거 + 컨텍스트 제한 + 캐시).

## 2. Entry Points
- Backend
  - `app/api/data_hub.py` (신규): permissions/upload/ask
  - `app/core/gemini_client.py` (신규): Gemini 호출
  - `app/core/data_hub_ai.py` (신규): RAG 컨텍스트/프롬프트/캐시 키
  - `app/main.py`: 라우터 등록
  - 기존: `app/api/documents.py`, `app/core/vector_store.py`
- Frontend
  - `frontend/src/pages/DataHub.jsx` (신규)
  - `frontend/src/App.jsx`: 라우트 추가
  - `frontend/src/components/GlobalTopBar.jsx`, `frontend/src/pages/SearchResults.jsx`: 빠른 메뉴 링크 활성화
  - `frontend/src/components/UploadWidget.jsx`: 업로드 endpoint/확장자 props 지원
  - 기존: `frontend/src/components/ResultList.jsx`, `frontend/src/components/DocumentDetail.jsx`

## 3. Files-to-Touch
- Add:
  - `docs/prd/data-hub-2026-02-15.md`
  - `.agent/execplans/2026-02-15-data-hub.md`
  - `app/api/data_hub.py`
  - `app/core/gemini_client.py`
  - `app/core/data_hub_ai.py`
  - `frontend/src/pages/DataHub.jsx`
  - `tests/test_data_hub_ai.py`
- Update:
  - `app/main.py`
  - `frontend/src/App.jsx`
  - `frontend/src/components/GlobalTopBar.jsx`
  - `frontend/src/pages/SearchResults.jsx`
  - `frontend/src/components/UploadWidget.jsx`
  - `docs/repo-map.md`

## 4. Requirements ↔ Test Mapping
| REQ-ID | Test Case | Proof |
| :--- | :--- | :--- |
| FE-REQ-001 | `/data-hub` 라우팅 + 빠른 메뉴 진입 | 브라우저에서 메뉴 클릭 후 이동 |
| BE-REQ-002 | 관리자만 업로드 가능 | 비관리자 업로드 403, 관리자 업로드 200 |
| BE-REQ-003/004 | RAG 컨텍스트 제한/프롬프트 생성 | `tests/test_data_hub_ai.py` |
| BE-REQ-005 | 캐시 키 동일성/TTL 동작 | `tests/test_data_hub_ai.py` |
| OPS-REQ-001 | verify 스크립트 통과 | `npm run verify:fast`, `npm run verify` |

## 5. Implementation Steps
1. PRD/ExecPlan 문서 추가.
2. Backend:
   - `data_hub` 라우터 추가(permissions/upload/ask).
   - Gemini 호출 모듈 구현(urllib 기반, env 기반 설정).
   - RAG 컨텍스트 축약/캐시 키/프롬프트 빌더 구현.
3. Frontend:
   - DataHub 페이지(검색/문서 리스트/상세/AI 답변/업로드) 구현.
   - 빠른 메뉴 “데이터 허브” 링크 활성화.
4. 테스트 추가 및 Docker 검증:
   - `docker exec -w /app synchub_web bash scripts/verify_fast.sh`
   - `bash scripts/verify.sh`
5. `docs/repo-map.md` 업데이트.
6. 원자적 커밋 후 `git push`.

## 6. Rollback Plan
- 관련 커밋을 `git revert <commit>`로 되돌린다.
- 페이지가 임시이므로 삭제는 `/data-hub` 라우트 및 `data_hub` 라우터/모듈 제거로 복구 가능.

## 7. Evidence
- verify 출력 로그
- 업로드/검색/AI 답변 동작 스크린샷(선택)
