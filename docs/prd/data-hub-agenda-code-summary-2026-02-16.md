# 데이터 허브: 안건 코드 검색 시 Gemini 요약

## 배경
- 데이터 허브(`/data-hub`)는 현재 문서(PDF) 검색과 RAG 기반 AI 답변 생성(`/data-hub/ask`)을 제공한다.
- 사용자는 데이터 허브에서 **안건 코드(예: `AG-2026-000123`)를 검색**했을 때, 문서가 아닌 **안건 내용 요약**을 빠르게 얻고 싶다.
- 프로젝트는 이미 `gemini-2.5-flash-lite`(환경변수 `GEMINI_MODEL`) 기반 AI 호출 로직을 사용 중이다.

## 목표
- 데이터 허브에서 검색어가 **안건 코드와 정확히 일치**하는 경우, **AI 답변 생성 버튼을 눌렀을 때만** Gemini로 안건 내용을 요약한다.

## 비목표
- 데이터 허브 검색 결과(문서 검색) 자체를 안건 검색으로 대체하지 않는다.
- 안건 요약을 자동으로(검색 즉시) 생성하지 않는다.
- 안건 권한 모델/공개 범위를 변경하지 않는다(기존 안건 조회 권한을 그대로 따른다).

## 용어
- 안건 코드: `agenda_threads.agenda_code` (형식: `AG-YYYY-NNNNNN`)

## 요구사항
- REQ-001: 사용자가 데이터 허브에서 검색어 `q`를 입력하고 **AI 답변 생성**을 눌렀을 때,
  - `q`가 **안건 코드 형식**이고,
  - `agenda_code == q` 로 **정확히 매칭되는 안건이 존재**하며,
  - 사용자에게 해당 안건 **열람 권한**이 있으면(게시됨 또는 본인 draft),
  - Gemini(`gemini-2.5-flash-lite`)로 **안건 내용 요약**을 생성한다.
- REQ-002: `q`가 안건 코드 형식이지만 **정확 매칭 안건이 없거나 권한이 없으면**, “안건 코드를 찾지 못했다”는 메시지를 반환한다(문서 RAG로 넘어가지 않음).
- REQ-003: `q`가 안건 코드 형식이 아니면, 기존과 동일하게 문서 RAG 기반 `/data-hub/ask` 응답을 반환한다.
- REQ-004: 프론트는 안건 요약 모드일 때, 안건으로 이동할 수 있는 링크(프로젝트/안건 상세) 정보를 표시한다.

## 수용 기준(AC)
- AC-001: `q=AG-2026-000001`(존재/권한 있음)로 `/data-hub/ask` 호출 시 응답에 `mode=agenda_summary`, `agenda.thread_id`, `agenda.project_id`, `answer`가 포함된다.
- AC-002: `q=AG-2026-999999`(없음)로 `/data-hub/ask` 호출 시 응답에 `mode=agenda_not_found`(또는 동등), 사용자 친화 메시지 `answer`, `sources=[]`가 포함된다.
- AC-003: 자연어 질의(예: `901 알람 조치방법`)는 기존 문서 RAG 동작이 유지된다.
- AC-004: 데이터 허브 UI에서 “AI 답변 생성” 클릭 시,
  - 안건 코드일 때는 “안건 요약”이 표시되고 안건 상세로 이동 링크가 보인다.

## 구현 메모
- 요약 입력은 안건 스레드 메타 + 엔트리(루트/최신/중간 일부) + 작업보고서 섹션(payload)이 포함되며, 프롬프트 길이는 안전한 한도 내에서 절단한다.
- `/data-hub/ask`는 기존과 동일하게 인증(로그인)만 요구한다.

