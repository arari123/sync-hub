# Execution Plan: Sync-Hub MVP Infrastructure & Backend

## 1. Goal
사내 지식 검색 MVP를 위한 인프라(Elasticsearch, OCR Worker) 구축 및 핵심 API 연동.

## 2. Entry Points
- API Docs: `http://localhost:8000/docs`
- ES Health: `http://localhost:9200/`
- Kibana: `http://localhost:5601/` (Optional)

## 3. Files-to-Touch
- `docker-compose.yml`: ES, Kibana 서비스 추가.
- `docker-compose.gpu.yml`: OCR Worker 서비스 추가.
- `requirements.txt`: `elasticsearch`, `sentence-transformers`, `python-multipart`, `pypdf`, `pillow` 등 추가.
- `app/main.py`: 라우터 연동.
- `app/api/documents.py`: 업로드 및 검색 API.
- `app/core/pipeline.py`: PDF 처리 로직.
- `app/core/ocr.py`: GLM-OCR 연동.

## 4. Requirements ↔ Test Mapping
| REQ-ID | Test Case | Proof |
| :--- | :--- | :--- |
| INF-001 | ES + Nori 플러그인 확인 | `GET /_analyze` with nori |
| REQ-001 | PDF 업로드 확인 | `POST /documents/upload` -> 202 Accepted |
| REQ-002 | OCR 처리 확인 | Check logs for GPU inference |
| REQ-004 | 검색 결과 확인 | `GET /search?q=...` -> JSON Results |

## 5. Implementation Steps

### Phase 1: Infrastructure (ES & Vector)
1. `docker-compose.yml`에 Elasticsearch 추가 및 `nori` 설치 명령 포함.
2. `docker-compose.gpu.yml`에 OCR 전용 워커 레이아웃 작성.
3. Elasticsearch를 벡터 저장소로 선택 (이유: 통합 검색 및 RRF 하이브리드 검색 용이성).

### Phase 2: PDF Logic & Pipeline
1. `requirements.txt` 업데이트 및 신규 라이브러리 설치.
2. `pypdf`를 이용한 기본 텍스트 추출 로직 구현.
3. GLM-OCR 연동용 스켈레톤 작성 (GPU 컨테이너 연동).

### Phase 3: Embedding & Search
1. `sentence-transformers`를 이용한 로컬 임베딩 연동.
2. Elasticsearch 인덱스 매핑 설정 (ko_nori 분석기 + dense_vector).
3. 검색 API 구현 (Hybrid Search).

### Phase 4: Verification
1. `verify` 스크립트 작성.
2. 샘플 PDF로 전체 흐름 테스트.

## 6. Rollback Plan
- Docker 볼륨 삭제 및 이미지 롤백.
- Git revert.

## 7. Evidence
(To be filled after implementation)
